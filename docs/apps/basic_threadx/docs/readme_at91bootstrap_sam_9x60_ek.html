<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title> - Harmony 3 Azure RTOS ThreadX configurations and application examples</title> <link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../../../assets/css/just-the-docs.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', "UA-2724382-16"); </script> <script type="text/javascript" src="../../../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../../../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Harmony 3 Azure RTOS ThreadX configurations and application examples | Harmony 3 Azure RTOS ThreadX configurations and application examples</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Harmony 3 Azure RTOS ThreadX configurations and application examples" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony 3 Azure RTOS ThreadX configurations and application examples" /> <meta property="og:description" content="Harmony 3 Azure RTOS ThreadX configurations and application examples" /> <link rel="canonical" href="../../../apps/basic_threadx/docs/readme_at91bootstrap_sam_9x60_ek.html" /> <meta property="og:url" content="../../../apps/basic_threadx/docs/readme_at91bootstrap_sam_9x60_ek.html" /> <meta property="og:site_name" content="Harmony 3 Azure RTOS ThreadX configurations and application examples" /> <script type="application/ld+json"> {"@type":"WebPage","url":"../../../apps/basic_threadx/docs/readme_at91bootstrap_sam_9x60_ek.html","headline":"Harmony 3 Azure RTOS ThreadX configurations and application examples","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"../../assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"description":"Harmony 3 Azure RTOS ThreadX configurations and application examples","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"> <title>Link</title> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="../../../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item active"><a href="../../../docs/docs/apps/basic_threadx/docs/readme_at91bootstrap_sam_9x60_ek.html" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="../../../docs/apps/basic_threadx/docs/readme_at91bootstrap_sam_a5d2_xult.html" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="../../../docs/docs/mplab_harmony_license.html" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="../../../apps/basic_threadx/docs/readme_at91bootstrap_sam_9x60_ek.html" class="navigation-list-link active"></a></li><li class="navigation-list-item active"><a href="../../../apps/basic_threadx/docs/readme_at91bootstrap_sam_a5d2_xult.html" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="../../../docs/apps/basic_threadx/docs/readme_at91bootstrap_sam_9x60_ek.html" class="navigation-list-link"></a></li><li class="navigation-list-item active"><a href="../../../docs/docs/apps/basic_threadx/docs/readme_at91bootstrap_sam_a5d2_xult.html" class="navigation-list-link"></a></li><li class="navigation-list-item"><a href="../../../index.html" class="navigation-list-link">Harmony 3 Azure RTOS ThreadX configurations and application examples</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="../../../apps/basic_threadx/readme.html" class="navigation-list-link">Azure RTOS ThreadX application examples</a></li></ul></li><li class="navigation-list-item"><a href="../../../release_notes.html" class="navigation-list-link">Release notes</a></li><li class="navigation-list-item"><a href="../../../mplab_harmony_license.html" class="navigation-list-link">License</a></li></ul> </nav> </div> <footer class="site-footer"> <p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p> </footer> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search Harmony 3 Azure RTOS ThreadX configurations and application examples" aria-label="Search Harmony 3 Azure RTOS ThreadX configurations and application examples" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> <ul class="list-style-none text-small aux-nav"> <li class="d-inline-block my-0"><a href="https://support.microchip.com">Obtain Support from Microchip</a></li> </ul> </div> <div class="page"> <div id="main-content" class="page-content" role="main"> <p><a href="https://www.microchip.com"><img src="https://www.microchip.com/ResourcePackages/Microchip/assets/dist/images/logo.png" alt="MCHP" /></a></p> <h1 id="bootstrapping-mpu-applications-using-at91bootstrap-loader"> <a href="#bootstrapping-mpu-applications-using-at91bootstrap-loader" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Bootstrapping MPU applications using At91bootstrap loader </h1> <p>MPU applications are linked to execute from external DRAM memory that is available on the evaluation kit. This require all peripherals and clock leading to the DRAM memory to be configured prior to the application being programmed. This is done using a bootstrap loader.</p> <p>Bootstrap loader project used for this purpose is a variant of the AT91Bootstrap project available for Microchip MPUs. It can be downloaded from <a href="https://github.com/linux4sam/at91bootstrap/tree/at91bootstrap-3.x-mplabx">here</a>. This project is adapted to be used from within MPLABx IDE on both Windows and Linux.</p> <p>To facilitate the debugging and running of the MPU application, each application in this repository is bundled with its own copy of the AT91Bootstrap project. Each copy of the bootstrap project can be found under same folder as the application project and is named and is prefixed with “at91bootstrap_”. For eg: if the application folder name is sam_9x60_ek.X, then bootstrap project folder will be named at91bootstrap_sam_9x60_ek.X and will be present at the same folder level.</p> <p>Bootstrap project is configured to load and execute a raw binary file named “harmony.bin” from the SD card. SD card slot to be used shall vary with the evaluation kit.</p> <p>Each application project is configured with a post build step which will generate the necessary binary file named “harmony.bin” at the end of each build.</p> <p>If you are only interested in running or debugging the MPU applications in this repository , you can skip the following sections and and jump straight to <a href="#debugging-mpu-applications-using-mplabx">Debugging MPU application using MPLABx</a>. Each copy of the bootstrap project in this repository is preconfigured to the correct evaluation kit.Also, the bootstrap binary files required to program and run the applications are checked into the repository.</p> <h2 id="building-at91bootstrap-project"> <a href="#building-at91bootstrap-project" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Building AT91Bootstrap project </h2> <ul> <li> <p>Bootstrap project can be configured using MPLABx using its KCONFIG menu. To do this, open the project in MPLABx, right click on the project and select “properties”. In categories, select “Kconfig” as shown below:</p> <p><img src="../../../apps/basic_threadx/docs/images/kconfig_9x60.png" alt="kconfig" /></p> </li> <li>Click on “LOAD” button and navigate to the boards folder inside the project. Choose the a default configuration file (defconfig) config file to select a target evaluation board and boot method <ul> <li>For eg: If you want to boot harmony.bin file from sd card for SAM9X60 evaluation kit, navigate to board/sam9x60ek folder and select “sam9x60eksd_harmony_defconfig” file</li> </ul> </li> <li> <p>Click on “Apply” and “OK” buttons to configure the project</p> </li> <li> <p>Build the project to generate the bootstrap binaries</p> </li> <li><em>Note: At91bootstrap project requires arm-gcc to build it. XC32 toolchain is not supported yet</em></li> </ul> <h2 id="configure-mplabx-application-to-use-at91bootstrap-loader"> <a href="#configure-mplabx-application-to-use-at91bootstrap-loader" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Configure MPLABx application to use AT91Bootstrap loader </h2> <p>MPLABx debugger relies on AT91Bootstrap to configure the board before programming the application binaries. To configure an application to use AT91Bootstrap, follow the steps detailed below:</p> <h3 id="configure-a-debug-tool"> <a href="#configure-a-debug-tool" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Configure a debug tool </h3> <ul> <li> <p>Right click on the application project and select properties. This will open the properties window. In the configuration option –&gt; connected hardware tools, select the debugger.</p> <p><img src="../../../apps/basic_threadx/docs/images/select_debug_9x60.png" alt="select_debugger" /></p> <p><em>Note: if no debugger is connected, click on the “show all” check box and select the supported debugger. Only Jlink options are supported</em></p> </li> <li> <p>Select the target toolchain and click on apply to save the changes</p> </li> <li> <p>This will result in an additional menu option to be available in the configuration tree view called “bootstrap” as shown below:</p> <p><img src="../../../apps/basic_threadx/docs/images/debug_bootstrap_9x60.png" alt="show_bootstrap" /></p> </li> </ul> <h3 id="configure-bootstrap"> <a href="#configure-bootstrap" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Configure bootstrap </h3> <ul> <li> <p>Click on “Use bootstrap” check box to enable bootstrap support</p> </li> <li> <p>Click on the “LOAD” button to load the bootstrap file. This will open a file picker, which allows you to choose the bootstrap binary file.</p> </li> <li> <p>Navigate to the “binaries” folder under the AT91Bootstrap project folder. This contains the build output of the bootstrap project. You can either choose the “AT91Bootstrap.elf” file or “boot.bin” file</p> <ul> <li>If ELF file is choosen, the “Bootstrap entry address” and the “Bootstrap load address” text box can be left empty as this information can be read from the ELF file</li> <li>If BIN file is chosen, the bootstrap entry address and the load address should be filled in their corresponding text boxes</li> <li> <p>An example configuration can be seen below. Here a relative path is used with respect to the project directory, to make the configuration portable</p> <p><img src="../../../apps/basic_threadx/docs/images/configured_bootstrap_9x60.png" alt="configured_bootstrap" /></p> </li> </ul> </li> </ul> <h2 id="debugging-mpu-applications-using-mplabx"> <a href="#debugging-mpu-applications-using-mplabx" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Debugging MPU applications using MPLABx </h2> <p>Once the applicaton is configured to use bootstrap loader, debugging the application is as simple right clicking the application and selecting “Debug” option. This will cause debugger to perform a two stage loading:</p> <p><strong>Stage 1:</strong> Loads the bootstrap loader into the internal SRAM and executes it. This will configure the board specific peripherals and memory</p> <p><strong>Stage 2:</strong> Loads the application into the external DRAM and debugs it. User can perform actions like setting breakpoints, single-stepping etc.</p> <p>Debugging the applicaton using MPLABx has the following limitations:</p> <ol> <li>Running application using debugger is not supported</li> <li>Call stack is not supported</li> <li>Step in, step out using debugger does not work</li> </ol> <p><em>Note:</em> Make sure that you reset the board between each debug sessions so that the debugger can attach to the target correctly</p> <h2 id="running-mpu-applications"> <a href="#running-mpu-applications" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Running MPU applications </h2> <p>To run the applications, copy both the application binary named “harmony.bin” and the bootstrap binary named “boot.bin” onto an SD card. Insert the SD card into the SD slot of the evaluation kit and press the reset button.</p> <p>The ROM bootloader will copy the bootstrap binary “boot.bin” into the internal SRAM and executes it. The bootstrap will configure the external DRAM and the required peripherals, then copy the applicaton binary “harmony.bin” into the DRAM and executes it.</p> <hr> <footer role="contentinfo"> <p class="text-small text-grey-dk-000 mb-0"><img src='../../../assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2020 Microchip Technology.</p> </footer> </div> </div> </div> </div> </body> </html>
